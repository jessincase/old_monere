{% extends 'base.html' %}
{% load app_filters %}
{% load humanize %}
{% load static %}

{% block title %}
  {{ board.title }} - {{ block.super }}
{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="{% url 'home' %}">Boards</a></li>
  <li class="breadcrumb-item active"><a href="{% url 'board_posts' pk=board.pk %}">{{ board.title }}</a></li>
{% endblock %}

{% block content %}
    <script>
    function add_chat(title) {
        var sidebar = $(".chat-sidebar");
        var ele = "<div class=\"sidebar-name\">" + title + "</div>";
        $("p").remove(".state");
        $("a").remove(".btn");
        sidebar.append(ele);

    }
</script>
  <div class="mb-4">
    <a href="{% url 'new_post' board.pk %}" class="btn btn-primary">New post</a>
  </div>

  <table class="table">
    <thead class="thead-inverse">
      <tr>
        <th>Post</th>
        <th>Starter</th>
        <th>Users in Chat</th>
        <th>Last Update</th>
      </tr>
    </thead>
    <tbody>
      {% for post in posts %}
        <tr>
            <td><a href="{% url 'chat_room' label=post.room.label %}"> {{ post.title }} </a> <br> {{ post.description }}<span>{% if post.original_poster == request.user %}
          <div class="mt-3 align-right">
            <a href="{% url 'edit_post' post.board.pk post.pk %}"
               class="btn btn-primary btn-sm"
               role="button">Edit</a>
          </div>
                {% else %}
                <br><br>
                <a onclick="register_popup('{{ post.room.room_id }}' , '{{ post.room.name }}', '{{ post.room.label }}')" class="btn btn-primary btn-sm" role="button">
                        Chat
                    </a>
        {% endif %}</span></td>
          <td>{{ post.original_poster.username }}</td>
          <td>{{ post.room.users_in_chat }}</td>
          <td>{{ post.room.last_update | naturaltime }}</td>

        </tr>

      {% endfor %}
    </tbody>
  </table>
{% endblock %}

{% block js %}
    <script src="{% static 'js/sidebar.js' %}"></script>
{% endblock %}

